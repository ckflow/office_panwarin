<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô - ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Sarabun', sans-serif; padding: 20px; }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .table th { background-color: #e9ecef; }
        .loading { text-align: center; margin-top: 50px; display: none; }
        #content { display: none; } /* ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ú‡πà‡∏≤‡∏ô */
    </style>
</head>
<body>

    <div id="auth-check" class="text-center mt-5">
        <h4>üîí ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...</h4>
    </div>

    <div id="content" class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="text-primary">üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Admin)</h4>
            <button class="btn btn-sm btn-outline-danger" onclick="liff.closeWindow()">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>

        <div class="card p-3">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th width="40%">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                            <th width="40%">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th width="20%" class="text-end">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                        </tr>
                    </thead>
                    <tbody id="price-table-body">
                        </tbody>
                </table>
            </div>
            <p id="empty-msg" class="text-center text-muted mt-3" style="display:none;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©</p>
        </div>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ 3 ‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö ---
        const MY_LIFF_ID = "2008689090-CnrdxM5k"; // ‡πÉ‡∏ä‡πâ ID ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
        const ADMIN_ID = "U4dc8fa32570dca3dfb4093b48a5c2093"; // ‡πÉ‡∏™‡πà User ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô)
        const N8N_API_URL = "https://n8n.ckflowsystem.com/webhook/get-prices"; // URL ‡∏à‡∏≤‡∏Å n8n ‡∏Ç‡πâ‡∏≠ 1
        // ------------------------

        async function main() {
            await liff.init({ liffId: MY_LIFF_ID });
            if (!liff.isLoggedIn()) {
                liff.login();
                return;
            }

            const profile = await liff.getProfile();
            
            // ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πà Admin ‡πÑ‡∏´‡∏°?
            if (profile.userId !== ADMIN_ID) {
                document.getElementById('auth-check').innerHTML = `
                    <h3 class="text-danger">‚õî Access Denied</h3>
                    <p>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</p>
                `;
                return;
            }

            // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà Admin ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            document.getElementById('auth-check').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            loadPrices();
        }
        main();

        async function loadPrices() {
            const tbody = document.getElementById('price-table-body');
            tbody.innerHTML = '<tr><td colspan="3" class="text-center">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';

            try {
                const response = await fetch(N8N_API_URL);
                const data = await response.json();

                tbody.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î

                if (data.length === 0) {
                    document.getElementById('empty-msg').style.display = 'block';
                    return;
                }

                // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                let lastCustomer = '';
                data.forEach(row => {
                    let customerDisplay = row.customer_name;
                    
                    // ‡∏•‡∏π‡∏Å‡πÄ‡∏•‡πà‡∏ô: ‡∏ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ö‡∏ô ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠ (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏î‡∏π‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ï‡∏≤)
                    if (row.customer_name === lastCustomer) {
                        customerDisplay = '<span style="opacity:0.2">"</span>'; 
                    } else {
                        lastCustomer = row.customer_name;
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏Ñ‡∏±‡πà‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ô
                        if (tbody.children.length > 0) {
                            // customerDisplay = `<div class="mt-2 fw-bold">${row.customer_name}</div>`; // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏ô‡πâ‡∏ô
                        }
                    }

                    const tr = `
                        <tr>
                            <td class="fw-bold text-secondary">${customerDisplay}</td>
                            <td>${row.product_name || row.product_code}</td>
                            <td class="text-end fw-bold text-success">${row.price}</td>
                        </tr>
                    `;
                    tbody.innerHTML += tr;
                });

            } catch (err) {
                tbody.innerHTML = `<tr><td colspan="3" class="text-danger text-center">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err}</td></tr>`;
            }
        }
    </script>
</body>
</html>